"use strict";(function(){var t,i,r,e,o,a=[],s=[],n=0,l=[1,2],h=function(i,r){if(this.parent=i,this.ctx=t,this.color=r.fill||!1,this.points=[],!r.img){for(var e=0;e<4;e++)this.points[e]=new ge1doot.transform3D.Point(i.pc.x+r.x[e]*i.normalZ+r.z[e]*i.normalX,i.pc.y+r.y[e],i.pc.z+r.x[e]*i.normalX+-r.z[e]*i.normalZ);this.points[3].next=!1}},g=function(t,i,r){this.img=new ge1doot.transform3D.Image(this,t+i.img,1,{isLoaded:function(t){t.parent.isLoaded=!0,t.parent.loaded(t)}}),this.visible=!1,this.normalX=i.nx,this.normalZ=i.nz,this.pc=new ge1doot.transform3D.Point(i.x,i.y,i.z),this.tx=i.x+i.nx*Math.sqrt(e.focalLength)*20,this.tz=i.z-i.nz*Math.sqrt(e.focalLength)*20,this.poly=[];for(var o,a=-1;o=r[++a];)s[a]=!0===o.img?1:2,this.poly.push(new h(this,o))},f=function(o){h.prototype.drawPoly=ge1doot.transform3D.drawPoly,r=new ge1doot.Screen({container:"canvas"}),t=r.ctx,r.resize(),i=new ge1doot.Pointer({tap:function(){if(e.over)if(e.over===e.target.elem)e.target.x=0,e.target.z=0,e.target.elem=!1;else{e.target.elem=e.over,e.target.x=e.over.tx,e.target.z=e.over.tz;for(var t,i=0;t=a[i++];){var r=e.target.x-t.pc.x,o=e.target.z-t.pc.z,s=Math.sqrt(r*r+o*o),n=s>1500?l[0]:l[1];t.img.setLevel(n)}}}}),e=new ge1doot.transform3D.Camera({focalLength:10*Math.sqrt(r.width),easeTranslation:.025,easeRotation:.06,disableRz:!0},{move:function(){this.over=!1,i.isDraging?(this.target.elem=!1,this.target.ry=.01*-i.Xi,this.target.rx=(i.Y-.5*r.height)/(.5*r.height)):this.target.elem&&(this.target.ry=Math.atan2(this.target.elem.pc.x-this.x,this.target.elem.pc.z-this.z)),this.target.rx*=.9}}),e.z=-1e4,e.py=0;for(var s,f=0;s=o.imgdata[f++];)a.push(new g(o.options.imagesPath,s,o.structure));setInterval(function(){l=n>50?[2,3]:[1,2],n=0},1e3),m()},m=function l(){t.clearRect(0,0,r.width,r.height),e.move();for(var h,g=-1;h=s[++g];){o=!1;for(var f,m=0;f=a[m++];)1===h&&f.draw()||f.visible&&f.poly[g].draw()}e.over&&!i.isDraging?r.setCursor("pointer"):r.setCursor("move"),n++,requestAnimFrame(l)};return h.prototype.draw=function(){var i=this.color;if(i.light||!o){var r=i.light?this.parent.light:1;o="rgba("+Math.round(i.r*r)+","+Math.round(i.g*r)+","+Math.round(i.b*r)+","+(i.a||1)+")",t.fillStyle=o}if(!i.light||this.parent.light<1){for(var e=0;this.points[e++].projection(););this.drawPoly(),t.fill()}},g.prototype.loaded=function(t){for(var i=[-1,1,1,-1,1,1,-1,-1],r=.5*t.texture.width,e=.5*t.texture.height,o=0;o<4;o++)t.points[o]=new ge1doot.transform3D.Point(this.pc.x+r*this.normalZ*i[o],this.pc.y+e*i[o+4],this.pc.z+r*this.normalX*i[o])},g.prototype.draw=function(){return this.pc.projection(),this.pc.Z>-(e.focalLength>>1)&&this.img.transform3D(!0)?(this.light=.5+.6*Math.abs(this.normalZ*e.cosY-this.normalX*e.sinY),this.visible=!0,this.img.draw(),(i.hasMoved||i.isDown)&&this.img.isPointerInside(i.X,i.Y)&&(e.over=this)):this.visible=!1,!0},{load:function(t){window.addEventListener("load",function(){ge1doot.loadJS("js/imageTransform3D.js",f,t)},!1)}}})().load({imgdata:imgdata,structure:[{fill:{r:255,g:255,b:255,light:1},x:[-1001,-490,-490,-1001],z:[-500,-500,-500,-500],y:[500,500,-500,-500]},{fill:{r:255,g:255,b:255,light:1},x:[-501,2,2,-500],z:[-500,-500,-500,-500],y:[500,500,-500,-500]},{fill:{r:255,g:255,b:255,light:1},x:[0,502,502,0],z:[-500,-500,-500,-500],y:[500,500,-500,-500]},{fill:{r:255,g:255,b:255,light:1},x:[490,1002,1002,490],z:[-500,-500,-500,-500],y:[500,500,-500,-500]},{fill:{r:0,g:0,b:0,a:.2},x:[-420,420,420,-420],z:[-500,-500,-500,-500],y:[150,150,-320,-320]},{fill:{r:0,g:0,b:0,a:.2},x:[-20,20,20,-20],z:[-500,-500,-500,-500],y:[250,250,150,150]},{fill:{r:0,g:0,b:0,a:.2},x:[-20,20,20,-20],z:[-500,-500,-500,-500],y:[-320,-320,-500,-500]},{fill:{r:0,g:0,b:0,a:.2},x:[-20,20,10,-10],z:[-500,-500,-100,-100],y:[-500,-500,-500,-500]},{fill:{r:32,g:32,b:32},x:[-50,50,50,-50],z:[-150,-150,-50,-50],y:[-500,-500,-500,-500]},{fill:{r:16,g:16,b:16},x:[-10,10,10,-10],z:[-100,-100,-100,-100],y:[300,300,-500,-500]},{fill:{r:255,g:255,b:255},x:[-320,-320,-320,-320],z:[0,-20,-20,0],y:[-190,-190,190,190]},{fill:{r:255,g:255,b:255},x:[320,320,320,320],z:[0,-20,-20,0],y:[-190,-190,190,190]},{img:!0},{fill:{r:255,g:128,b:0},x:[-50,50,50,-50],z:[450,450,550,550],y:[500,500,500,500]},{fill:{r:255,g:128,b:0},x:[-50,50,50,-50],z:[450,450,550,550],y:[-500,-500,-500,-500]}],options:{imagesPath:""}});